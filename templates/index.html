<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Great Circles on Two Different Map Projections</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <!-- ... (rest of your HTML file remains unchanged) ... -->

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var img1 = document.getElementById('mapImage1');
            var img2 = document.getElementById('mapImage2');
            var submitButton = document.querySelector('button[type="submit"]');
            var spinner = document.getElementById('spinner');
    
            function enableButton() {
                if (img1 && img2 && img1.complete && img2.complete) {
                    submitButton.disabled = false;
                    spinner.style.display = 'none';
                }
            }
    
            if (img1 && img2) {
                img1.addEventListener('load', enableButton);
                img2.addEventListener('load', enableButton);
            }

            // New code to populate the dropdown menus
            $.ajax({
                url: "{{ url_for('get_location_pairs') }}",
                method: "GET",
                success: function(data) {
                    if (data.error) {
                        alert(data.error);
                    } else {
                        var dropdown1 = document.getElementById('dropdown1');
                        var dropdown2 = document.getElementById('dropdown2');

                        for (var i = 0; i < data.location_pairs.length; i++) {
                            var pair = data.location_pairs[i];
                            var option1 = document.createElement('option');
                            var option2 = document.createElement('option');
                            option1.value = option2.value = pair.id;
                            option1.textContent = option2.textContent = pair.name;
                            dropdown1.appendChild(option1);
                            dropdown2.appendChild(option2);
                        }
                    }
                }
            });
        });

        $('#locationsForm').on('submit', function(e) {
            e.preventDefault();

            $.ajax({
                url: "{{ url_for('generate_map_ajax') }}",
                method: "POST",
                data: $(this).serialize(),
                beforeSend: function() {
                    $("button[type='submit']").prop("disabled", true);
                    $('#spinner').show();
                },
                success: function(data) {
                    console.log(data);
                    if (data.error) {
                        alert(data.error);
                    } else {
                        $('#mapImage1').attr('src', data.filename_plate_carree);
                        $('#mapImage2').attr('src', data.filename_azimuthal_equidistant);
                    }
                },
                complete: function() {
                    $("button[type='submit']").prop("disabled", false);
                    $('#spinner').hide();
                }
            });
        });
    </script>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
