<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Display Great Circles on Two Different Map Projections</title>
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='styles.css') }}">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>
<body>
    <h1>Display Great Circles on Two Different Map Projections</h1>
    <p>This web page is designed to help people get a better understanding of great circles, which are the shortest paths between two points on the surface of a sphere, and map projections, which are methods for representing the surface of a sphere in two dimensions. We use Planet Earth as our example sphere. Learn more about <a href="https://example.com/great-circles">great circles</a> and <a href="https://example.com/map-projections">map projections</a>.</p>
    
    <form id="locationsForm">
        <!-- Fieldset for the first pair of locations -->
        <fieldset>
            <legend>First Pair of Locations</legend>
            <input type="checkbox" id="pair1Checkbox" checked>
            <label for="pair1Checkbox">Enable/Disable Pair</label>
            <!-- ... rest of your form code ... -->

    <!-- Add the img tags here -->
    {% if filename_plate_carree %}
        <img src="{{ url_for('serve_map1', filename=filename_plate_carree) }}" alt="PlateCarree projection" id="mapImage1">
    {% endif %}
    
    {% if filename_azimuthal_equidistant %}
        <img src="{{ url_for('serve_map2', filename=filename_azimuthal_equidistant) }}" alt="AzimuthalEquidistant projection" id="mapImage2">
    {% endif %}

    <div id="mapProjection1"></div>
    <div id="mapProjection2"></div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var img1 = document.getElementById('mapImage1');
            var img2 = document.getElementById('mapImage2');
            var submitButton = document.querySelector('button[type="submit"]');
            var spinner = document.getElementById('spinner');
    
            function enableButton() {
                if (img1 && img2 && img1.complete && img2.complete) {
                    submitButton.disabled = false;
                    spinner.style.display = 'none';
                }
            }
    
            if (img1 && img2) {
                img1.addEventListener('load', enableButton);
                img2.addEventListener('load', enableButton);
            }
        });

        $('#locationsForm').on('submit', function(e) {
            e.preventDefault();

            $.ajax({
                url: "{{ url_for('generate_map_ajax') }}",
                method: "POST",
                data: $(this).serialize(),
                beforeSend: function() {
                    $("button[type='submit']").prop("disabled", true);
                    $('#spinner').show();
                },
                success: function(data) {
                    if (data.error) {
                        alert(data.error);
                    } else {
                        $('#mapImage1').attr('src', "{{ url_for('serve_map1', filename='') }}" + data.filename_plate_carree);
                        $('#mapImage2').attr('src', "{{ url_for('serve_map2', filename='') }}" + data.filename_azimuthal_equidistant);
                    }
                },
                complete: function() {
                    $("button[type='submit']").prop("disabled", false);
                    $('#spinner').hide();
                }
            });
        });
    </script>
</body>
</html>
